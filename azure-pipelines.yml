# What makes this pipeline run? When code gets checked into master
trigger:
- master

# The build agent will use the latest version of Windows, with all the latest stuff
pool:
  vmImage: 'windows-latest'

# Let's actually deploy our website
steps:
- task: PowerShell@2
  inputs:
    targetType: 'inline'
    script: |
      $username = "admin"
      $password = "CddjFj8GK0Se"
      $instance = "dev65180"
      $message = "Please release the new code with commit `"$(Build.SourceVersionMessage)`""
      $cred = New-Object System.Management.Automation.PSCredential -ArgumentList @($username,(ConvertTo-SecureString -String $password -AsPlainText -Force))
      
      $sn = New-WebServiceProxy -uri http://$instance.service-now.com/incident.do?WSDL â€”Credential $cred
      $get = new-object ($type + '.get')
      $getRecords = new-object ($type + '.getRecords')
      $update = new-object ($type + '.update')
      $insert = new-object ($type + '.insert')
      
# Copy all the website files to the Azure storage account
- task: AzureFileCopy@3
  inputs:
    SourcePath: '.'
    azureSubscription: 'Visual Studio Professional(a7c01838-8c1a-463f-85db-9b46c88dd664)'
    Destination: 'AzureBlob'
    storage: 'psandlweb'
    ContainerName: '$web'

# Output what we just built, for safe keeping
- task: PowerShell@2
  inputs:
    targetType: 'inline'
    script: 'Write-Host "Published build with $(Build.SourceVersionMessage)"'